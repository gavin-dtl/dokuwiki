
<h2 class="sectionedit1" id="android_50_wifi_感叹号问题">android_5.0 wifi 感叹号问题</h2>
<div class="level2">

<p>
安卓5.0引入了一种新的网络评估机制来评估网络状况，当你有网络请求时会自动选择网络连接条件最好的一个网络进行连接。如果谷歌（谷歌服务）发现WiFi网络无法上网（更确切地说可能是无法连接Google服务器），而且设备有移动网络可用，就会自动切换到2G/3G/LTE，放弃使用WiFi网络，让你保持联网。并且让WiFi网络的标志上面显示感叹号标志。
</p>

</div>
<!-- EDIT1 SECTION "android_5.0 wifi 感叹号问题" [1-504] -->
<h3 class="sectionedit2" id="处理方法">处理方法</h3>
<div class="level3">
<ol>
<li class="level1 node"><div class="li"> 络检查功能，最简单快速，但是就没有办法提示wifi登陆：</div>
<ul>
<li class="level2"><div class="li"><pre class="code">adb shell su -c &quot;settings put global captive_portal_detection_enabled 0&quot;</pre>
</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> 用国内的服务器替换掉google的服务器：</div>
<ul>
<li class="level2"><div class="li"><pre class="code">adb shell su -c &quot;settings put global captive_portal_server xn--yet824cpd.xn--fiqs8s&quot;</pre>
</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> 修改默认值</div>
<ul>
<li class="level2"><div class="li"><pre class="code cpp">     <span class="nu0">10</span> <span class="sy2">---</span> a<span class="sy2">/</span>frameworks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>res<span class="sy2">/</span>values<span class="sy2">/</span>defaults.<span class="me1">xml</span>
     <span class="nu0">11</span> <span class="sy2">+++</span> b<span class="sy2">/</span>frameworks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>res<span class="sy2">/</span>values<span class="sy2">/</span>defaults.<span class="me1">xml</span>
     <span class="nu0">12</span> @@ <span class="sy2">-</span><span class="nu0">223</span>,<span class="nu0">5</span> <span class="sy2">+</span><span class="nu0">223</span>,<span class="nu0">6</span> @@
     <span class="nu0">13</span>         <span class="sy1">&lt;</span>integer name<span class="sy1">=</span><span class="st0">&quot;def_hdmi_persent&quot;</span><span class="sy1">&gt;</span><span class="nu0">25700</span><span class="sy1">&lt;</span><span class="sy2">/</span>integer<span class="sy1">&gt;</span>
     <span class="nu0">14</span>         
     <span class="nu0">15</span>         <span class="sy1">&lt;</span>integer name<span class="sy1">=</span><span class="st0">&quot;def_mouse_advance&quot;</span><span class="sy1">&gt;</span><span class="nu0">30</span><span class="sy1">&lt;</span><span class="sy2">/</span>integer<span class="sy1">&gt;</span>
     <span class="nu0">16</span> <span class="sy2">+</span>       <span class="sy1">&lt;</span>integer name<span class="sy1">=</span><span class="st0">&quot;def_captive_portal_detection_enabled&quot;</span><span class="sy1">&gt;</span><span class="nu0">0</span><span class="sy1">&lt;</span><span class="sy2">/</span>integer<span class="sy1">&gt;</span>
     <span class="nu0">17</span>  
     <span class="nu0">18</span>  <span class="sy1">&lt;</span><span class="sy2">/</span>resources<span class="sy1">&gt;</span>
     <span class="nu0">19</span> diff <span class="sy2">--</span>git a<span class="sy2">/</span>frameworks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>src<span class="sy2">/</span>com<span class="sy2">/</span>android<span class="sy2">/</span>providers<span class="sy2">/</span>settings<span class="sy2">/</span>DatabaseHelper.<span class="me1">java</span> b<span class="sy2">/</span>framewor     <span class="nu0">19</span> ks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>src<span class="sy2">/</span>com<span class="sy2">/</span>android<span class="sy2">/</span>providers<span class="sy2">/</span>settings<span class="sy2">/</span>DatabaseHelper.<span class="me1">java</span>
     <span class="nu0">20</span> index 4e9164f..<span class="me1">e07c57a</span> <span class="nu0">100755</span>
     <span class="nu0">21</span> <span class="sy2">---</span> a<span class="sy2">/</span>frameworks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>src<span class="sy2">/</span>com<span class="sy2">/</span>android<span class="sy2">/</span>providers<span class="sy2">/</span>settings<span class="sy2">/</span>DatabaseHelper.<span class="me1">java</span>
     <span class="nu0">22</span> <span class="sy2">+++</span> b<span class="sy2">/</span>frameworks<span class="sy2">/</span>base<span class="sy2">/</span>packages<span class="sy2">/</span>SettingsProvider<span class="sy2">/</span>src<span class="sy2">/</span>com<span class="sy2">/</span>android<span class="sy2">/</span>providers<span class="sy2">/</span>settings<span class="sy2">/</span>DatabaseHelper.<span class="me1">java</span>
     <span class="nu0">23</span> @@ <span class="sy2">-</span><span class="nu0">2693</span>,<span class="nu0">6</span> <span class="sy2">+</span><span class="nu0">2693</span>,<span class="nu0">10</span> @@ <span class="kw2">public</span> <span class="kw2">class</span> DatabaseHelper extends SQLiteOpenHelper <span class="br0">&#123;</span>
     <span class="nu0">24</span>                      R.<span class="kw4">bool</span>.<span class="me1">def_guest_user_enabled</span><span class="br0">&#41;</span><span class="sy4">;</span>
     <span class="nu0">25</span>              loadSetting<span class="br0">&#40;</span>stmt, Settings.<span class="me1">Global</span>.<span class="me1">ENHANCED_4G_MODE_ENABLED</span>, ImsConfig.<span class="me1">FeatureValueConstants</span>.<span class="me1">ON</span><span class="br0">&#41;</span><span class="sy4">;</span>
     <span class="nu0">26</span>              <span class="co1">// --- New global settings start here</span>
     <span class="nu0">27</span> <span class="sy2">+</span>            
     <span class="nu0">28</span> <span class="sy2">+</span>            loadIntegerSetting<span class="br0">&#40;</span>stmt, Settings.<span class="me1">Global</span>.<span class="me1">CAPTIVE_PORTAL_DETECTION_ENABLED</span>, 
     <span class="nu0">29</span> <span class="sy2">+</span>                    R.<span class="me1">integer</span>.<span class="me1">def_captive_portal_detection_enabled</span><span class="br0">&#41;</span><span class="sy4">;</span>
     <span class="nu0">30</span> <span class="sy2">+</span>
     <span class="nu0">31</span>          <span class="br0">&#125;</span> finally <span class="br0">&#123;</span>
     <span class="nu0">32</span>              <span class="kw1">if</span> <span class="br0">&#40;</span>stmt <span class="sy3">!</span><span class="sy1">=</span> null<span class="br0">&#41;</span> stmt.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy4">;</span>
     <span class="nu0">33</span>          <span class="br0">&#125;</span>
&nbsp;
&nbsp;</pre>
</div>
</li>
</ul>
</li>
</ol>

</div>
<!-- EDIT2 SECTION "处理方法" [505-] -->