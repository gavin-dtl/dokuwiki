
<h2 class="sectionedit1" id="修改cpu频率">修改cpu频率</h2>
<div class="level2">

<p>
device/mstar/arbutus/preinstall/cpu_dvfs_scaling.sh
</p>
<pre class="code bash"><span class="co0">#!/system/bin/sh</span>
&nbsp;
<span class="kw3">echo</span> <span class="nu0">1</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>delay_free<span class="sy0">/</span>cma_force_free_cache
&nbsp;
<span class="re2">action</span>=$<span class="br0">&#40;</span>getprop mstar.cpu.dvfs.scaling<span class="br0">&#41;</span>
<span class="kw3">echo</span> <span class="re1">$action</span>
&nbsp;
<span class="kw2">chmod</span> <span class="nu0">660</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
&nbsp;
<span class="re2">benchmark_boost_client_id</span>=<span class="nu0">64</span>
<span class="co0">#benchmark_boost_freq=1400000</span>
<span class="re2">benchmark_boost_freq</span>=<span class="nu0">1294000</span>
&nbsp;
<span class="re2">launch_boost_client_id</span>=<span class="nu0">128</span>
<span class="co0">#launch_boost_freq=1400000</span>
<span class="re2">launch_boost_freq</span>=<span class="nu0">1294000</span>
<span class="re2">launch_boost_duration</span>=<span class="nu0">5</span>
&nbsp;
<span class="co0">#uhd_boost_client_id=160</span>
<span class="co0">#uhd_boost_freq=700000</span>
&nbsp;
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$action</span>&quot;</span> == <span class="st0">&quot;benchmark&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="co0"># start app boost</span>
    <span class="kw3">echo</span> $<span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="br0">&#40;</span><span class="re1">$benchmark_boost_client_id</span><span class="sy0">&lt;&lt;</span><span class="nu0">22</span><span class="br0">&#41;</span> + <span class="re1">$benchmark_boost_freq</span> <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
    <span class="kw2">sh</span> <span class="sy0">/</span>system<span class="sy0">/</span>bin<span class="sy0">/</span>benchmark_boost_monitor.sh <span class="sy0">&amp;</span>
    <span class="kw3">exit</span> <span class="nu0">0</span>
&nbsp;
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$action</span>&quot;</span> == <span class="st0">&quot;reset&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="co0"># try to stop app boost; if app boost is not running, we just lose some time for executing a command for nothing</span>
    <span class="kw3">echo</span> $<span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="br0">&#40;</span><span class="re1">$benchmark_boost_client_id</span><span class="sy0">&lt;&lt;</span><span class="nu0">22</span><span class="br0">&#41;</span> + <span class="nu0">0</span> <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
&nbsp;
    <span class="co0"># start launch boost</span>
    <span class="kw3">echo</span> $<span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="br0">&#40;</span><span class="re1">$launch_boost_client_id</span><span class="sy0">&lt;&lt;</span><span class="nu0">22</span><span class="br0">&#41;</span> + <span class="re1">$launch_boost_freq</span> <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
&nbsp;
    <span class="kw2">sleep</span> <span class="re1">$launch_boost_duration</span>
&nbsp;
    <span class="co0"># stop launch boost</span>
    <span class="kw3">echo</span> $<span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="br0">&#40;</span><span class="re1">$launch_boost_client_id</span><span class="sy0">&lt;&lt;</span><span class="nu0">22</span><span class="br0">&#41;</span> + <span class="nu0">0</span> <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
&nbsp;
    <span class="kw3">exit</span> <span class="nu0">0</span>
&nbsp;
<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$action</span>&quot;</span> == <span class="st0">&quot;4k2kmode&quot;</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
    <span class="kw3">echo</span> $<span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="br0">&#40;</span><span class="re1">$uhd_boost_client_id</span><span class="sy0">&lt;&lt;</span><span class="nu0">22</span><span class="br0">&#41;</span> + <span class="re1">$uhd_boost_freq</span> <span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>proc<span class="sy0">/</span>CPU_calibrating
    <span class="kw3">exit</span> <span class="nu0">0</span>
<span class="kw1">fi</span>
&nbsp;
busybox devmem 0x1F200A1C <span class="nu0">16</span></pre>

</div>
