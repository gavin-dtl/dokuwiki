
<h1 class="sectionedit1" id="rtl8723bu_wifi_bt_模块移植">rtl8723bu wifi+bt 模块移植</h1>
<div class="level1">
<hr />

</div>
<!-- EDIT1 SECTION "rtl8723bu wifi+bt 模块移植" [1-51] -->
<h3 class="sectionedit2" id="wifi">Wifi</h3>
<div class="level3">
<ol>
<li class="level1 node"><div class="li"> 修改驱动配置</div>
<ul>
<li class="level2"><div class="li"> 修改drivers/net/wireless/目录下makefile 及Kconfig 添加对对应的编译信息</div>
</li>
<li class="level2"><div class="li"> 修改drivers/net/wireless/rtl8723BU/Makefile 所编译驱动模块</div>
</li>
<li class="level2"><div class="li"> 修改drivers/net/wireless/rtl8723BU/Makefile 所编译驱动平台</div>
</li>
<li class="level2"><div class="li"> 修改drivers/net/wireless/rtl8723BU/Makefile </div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> 配置linux内核</div>
<ul>
<li class="level2"><div class="li"> 配置Device Drivers  —&gt;USB support  —&gt;&lt;*&gt;   USB Wireless Device Management support 支持WIFI</div>
</li>
<li class="level2"><div class="li"> Networking support —&gt;Wireless下增加802.11 协议栈的支持</div>
</li>
<li class="level2"><div class="li"> <pre class="code">      --- Wireless                         
      &lt;M&gt;   cfg80211 - wireless configuration API
      [*]     nl80211 testmode command   
      [*]     enable developer warnings                                                                                                     
      [*]     cfg80211 regulatory debugging 
      [*]     enable powersave by default
      [ ]     cfg80211 DebugFS entries
      [ ]     use statically compiled regulatory rules database  
      [*]     cfg80211 wireless extensions compatibility
        [*]   Wireless extensions sysfs files 
      -*-   Common routines for IEEE802.11 drivers
      [ ]   lib80211 debugging messages  
      [*]   Allow reconnect while already connected 
      &lt;M&gt;   Generic IEEE 802.11 Networking Stack (mac80211)  
      [ ]   PID controller based rate control algorithm  
      [*]   Minstrel
      [*]     Minstrel 802.11n support  
           Default rate control algorithm (Minstrel)  ---&gt;  
      [*]   Enable mac80211 mesh networking (pre-802.11s) support 
        [*]   Enable LED triggers  
      [ ]   Export mac80211 internals in DebugFS
      [ ]   Select mac80211 debugging features  ---&gt; 
    </pre>
</div>
</li>
<li class="level2"><div class="li"> 如果未配置好上述则在加载驱动时出现如下错误,原因就是：编译WiFi模块时会去KSRC所指的路径下找相应的库，若果相关的编译选项没有选上会导       致某些库缺失，从而导致编出来的WiFi模块不完整。上述是由于编译内核时内有勾选80211协议栈导致。</div>
</li>
<li class="level2"><div class="li"> <pre class="code">      shell@arbutus:/ # insmod system/lib/modules/8723bu.ko                          
      [ 1862.817051] 8723bu: Unknown symbol __ieee80211_get_channel (err 0)
      [ 1862.823636] 8723bu: Unknown symbol wiphy_register (err 0)
      [ 1862.829281] 8723bu: Unknown symbol wiphy_new (err 0)
      [ 1862.834454] 8723bu: Unknown symbol cfg80211_scan_done (err 0)
      [ 1862.841568] 8723bu: Unknown symbol cfg80211_rx_mgmt (err 0)
      [ 1862.847403] 8723bu: Unknown symbol cfg80211_inform_bss_frame (err 0)
      [ 1862.854124] 8723bu: Unknown symbol cfg80211_ibss_joined (err 0)
      [ 1862.860367] 8723bu: Unknown symbol wiphy_apply_custom_regulatory (err 0)
      [ 1862.867290] 8723bu: Unknown symbol cfg80211_new_sta (err 0)
      [ 1862.873435] 8723bu: Unknown symbol cfg80211_disconnected (err 0)
      [ 1862.879603] 8723bu: Unknown symbol cfg80211_connect_result (err 0)
      [ 1862.886143] 8723bu: Unknown symbol wiphy_unregister (err 0)
      [ 1862.892129] 8723bu: Unknown symbol ieee80211_frequency_to_channel (err 0)
      [ 1862.899059] 8723bu: Unknown symbol cfg80211_get_bss (err 0)
      [ 1862.904915] 8723bu: Unknown symbol cfg80211_ready_on_channel (err 0)
      [ 1862.911540] 8723bu: Unknown symbol cfg80211_unlink_bss (err 0)
      [ 1862.917513] 8723bu: Unknown symbol cfg80211_roamed (err 0)
      [ 1862.923190] 8723bu: Unknown symbol wiphy_free (err 0)
      [ 1862.928409] 8723bu: Unknown symbol cfg80211_mgmt_tx_status (err 0)
      [ 1862.934723] 8723bu: Unknown symbol cfg80211_remain_on_channel_expired (err 0)
      [ 1862.942053] 8723bu: Unknown symbol cfg80211_michael_mic_failure (err 0)
      [ 1862.948779] 8723bu: Unknown symbol cfg80211_del_sta (err 0)
      [ 1862.954630] 8723bu: Unknown symbol cfg80211_put_bss (err 0)
      insmod: init_module &#039;system/lib/modules/8723bu.ko&#039; failed (No such file or directory)
     </pre>
</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> 测试</div>
<ul>
<li class="level2"><div class="li"> 安装cfg80211.ko，8723bu.ko依赖此模块，否则依然会报上述缺80211的错误</div>
</li>
<li class="level2"><div class="li"> 安装8723bu.ko模块，两个模块都安装好之后，执行netcfg，会看到多出wlan0和wlan1设备节点，他们是8723bu驱动创建出来的，放到   		sys/class/net/下。</div>
</li>
</ul>
</li>
<li class="level1 node"><div class="li"> wifi android 适配</div>
<ul>
<li class="level2"><div class="li"> device\mstar\pitaya\preinstall\wifi wifi.cfg 添加对于的wifi usb设备的pid，uid</div>
</li>
<li class="level2"><div class="li"> device\mstar\common\preinstall\wifi 添加wifi适配对应文件有</div>
</li>
<li class="level2"><div class="li"> <pre class="code">      startSupplicant.sh
      wifi_load_apdriver.sh
      wifi_load_driver.sh
      wifi_unload_apdriver.sh
      wifi_unload_driver.sh
    </pre>
</div>
</li>
<li class="level2"><div class="li"> <pre class="code bash">      Index: startSupplicant.sh
      ===================================================================
      <span class="re5">---</span> startSupplicant.sh	<span class="br0">&#40;</span>revision <span class="nu0">130</span><span class="br0">&#41;</span>
      +++ startSupplicant.sh	<span class="br0">&#40;</span>working copy<span class="br0">&#41;</span>
      <span class="sy0">@@</span> -<span class="nu0">2</span>,<span class="nu0">7</span> +<span class="nu0">2</span>,<span class="nu0">7</span> <span class="sy0">@@</span>
&nbsp;
       <span class="kw3">echo</span> <span class="st0">&quot;startSupplicant $1&quot;</span>
       <span class="kw1">case</span> <span class="re4">$1</span> <span class="kw1">in</span>
      <span class="re5">-RTL8192CU</span><span class="sy0">|</span>RTL8192DU<span class="sy0">|</span>RTL8192EU<span class="sy0">|</span>RTL8812AUS<span class="sy0">|</span>RTL8188ETV<span class="br0">&#41;</span>
      +RTL8723BU<span class="sy0">|</span>RTL8192CU<span class="sy0">|</span>RTL8192DU<span class="sy0">|</span>RTL8192EU<span class="sy0">|</span>RTL8812AUS<span class="sy0">|</span>RTL8188ETV<span class="br0">&#41;</span>
       wpa_supplicant <span class="re5">-ip2p0</span> <span class="re5">-Dnl80211</span> -c<span class="sy0">/</span>data<span class="sy0">/</span>misc<span class="sy0">/</span>wifi<span class="sy0">/</span>p2p_supplicant.conf -e<span class="sy0">/</span>data<span class="sy0">/</span>misc<span class="sy0">/</span>wifi<span class="sy0">/</span>entropy.bin -puse_p2<span class="re2">p_group_interface</span>=<span class="nu0">0</span> <span class="re5">-N</span> \
           <span class="re5">-iwlan0</span> <span class="re5">-Dnl80211</span> -c<span class="sy0">/</span>data<span class="sy0">/</span>misc<span class="sy0">/</span>wifi<span class="sy0">/</span>wpa_supplicant.conf \
           -g<span class="sy0">/</span>data<span class="sy0">/</span>system<span class="sy0">/</span>wpa_supplicant<span class="sy0">/</span>wlan0 <span class="re5">-G1010</span> -O<span class="sy0">/</span>data<span class="sy0">/</span>misc<span class="sy0">/</span>wifi<span class="sy0">/</span>sockets
      Index: wifi_load_apdriver.sh
      ===================================================================
      <span class="re5">---</span> wifi_load_apdriver.sh	<span class="br0">&#40;</span>revision <span class="nu0">130</span><span class="br0">&#41;</span>
      +++ wifi_load_apdriver.sh	<span class="br0">&#40;</span>working copy<span class="br0">&#41;</span>
      <span class="sy0">@@</span> -<span class="nu0">19</span>,<span class="nu0">6</span> +<span class="nu0">19</span>,<span class="nu0">11</span> <span class="sy0">@@</span>
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8192cu.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
       <span class="kw2">sleep</span> <span class="nu0">1</span>
       <span class="sy0">;;</span>
      +RTL8723BU<span class="br0">&#41;</span>
      +insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>cfg80211.ko
      +insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8723bu.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
      +<span class="kw2">sleep</span> <span class="nu0">1</span>
      +<span class="sy0">;;</span>
       RTL8192DU<span class="br0">&#41;</span>
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>cfg80211.ko
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8192du.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
      Index: wifi_load_driver.sh
      ===================================================================
      <span class="re5">---</span> wifi_load_driver.sh	<span class="br0">&#40;</span>revision <span class="nu0">130</span><span class="br0">&#41;</span>
      +++ wifi_load_driver.sh	<span class="br0">&#40;</span>working copy<span class="br0">&#41;</span>
      <span class="sy0">@@</span> -<span class="nu0">19</span>,<span class="nu0">6</span> +<span class="nu0">19</span>,<span class="nu0">10</span> <span class="sy0">@@</span>
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8192cu.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
       <span class="kw2">sleep</span> <span class="nu0">1</span>
       <span class="sy0">;;</span>
      +RTL8723BU<span class="br0">&#41;</span>
      +insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>cfg80211.ko
      +insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8723bu.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
      +<span class="sy0">;;</span>
       RTL8192DU<span class="br0">&#41;</span>
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>cfg80211.ko
       insmod <span class="sy0">/</span>system<span class="sy0">/</span>lib<span class="sy0">/</span>modules<span class="sy0">/</span>8192du.ko <span class="re2">ifname</span>=wlan0 <span class="re2">if2name</span>=p2p0
      Index: wifi_unload_apdriver.sh
      ===================================================================
      <span class="re5">---</span> wifi_unload_apdriver.sh	<span class="br0">&#40;</span>revision <span class="nu0">130</span><span class="br0">&#41;</span>
      +++ wifi_unload_apdriver.sh	<span class="br0">&#40;</span>working copy<span class="br0">&#41;</span>
      <span class="sy0">@@</span> -<span class="nu0">22</span>,<span class="nu0">6</span> +<span class="nu0">22</span>,<span class="nu0">12</span> <span class="sy0">@@</span>
       rmmod 8192cu.ko
       rmmod cfg80211.ko
       <span class="sy0">;;</span>
      +RTL8723BU<span class="br0">&#41;</span>
      +busybox <span class="kw2">ifconfig</span> p2p0 down
      +busybox <span class="kw2">ifconfig</span> wlan0 down
      +rmmod 8723bu.ko
      +rmmod cfg80211.ko
      +<span class="sy0">;;</span>
       RTL8192DU<span class="br0">&#41;</span>
       busybox <span class="kw2">ifconfig</span> p2p0 down
       busybox <span class="kw2">ifconfig</span> wlan0 down
      Index: wifi_unload_driver.sh
      ===================================================================
      <span class="re5">---</span> wifi_unload_driver.sh	<span class="br0">&#40;</span>revision <span class="nu0">130</span><span class="br0">&#41;</span>
      +++ wifi_unload_driver.sh	<span class="br0">&#40;</span>working copy<span class="br0">&#41;</span>
      <span class="sy0">@@</span> -<span class="nu0">15</span>,<span class="nu0">6</span> +<span class="nu0">15</span>,<span class="nu0">12</span> <span class="sy0">@@</span>
       rmmod 8192cu.ko
       rmmod cfg80211.ko
       <span class="sy0">;;</span>
      +RTL8723BU<span class="br0">&#41;</span>
      +busybox <span class="kw2">ifconfig</span> p2p0 down
      +busybox <span class="kw2">ifconfig</span> wlan0 down
      +rmmod 8723bu.ko
      +rmmod cfg80211.ko
      +<span class="sy0">;;</span>
       RTL8192DU<span class="br0">&#41;</span>
       busybox <span class="kw2">ifconfig</span> p2p0 down
       busybox <span class="kw2">ifconfig</span> wlan0 down
&nbsp;</pre>
</div>
</li>
<li class="level2"><div class="li"> <pre class="code bash">      +<span class="re2">wifi_vendor_name</span>=RTL8723BU
      +<span class="re2">order</span>=<span class="nu0">8</span>
      +<span class="re2">count_vid_pid</span>=<span class="nu0">1</span>
      +<span class="re2">vid_pid</span>=0x0bda:0xb720
      +<span class="re2">sta</span>=<span class="nu0">1</span>
      +<span class="re2">softap</span>=<span class="nu0">1</span>
      +<span class="re2">p2p</span>=<span class="nu0">1</span> 
&nbsp;</pre>
</div>
</li>
</ul>
</li>
</ol>
<hr />

</div>
<!-- EDIT2 SECTION "Wifi" [52-7794] -->
<h3 class="sectionedit3" id="bt">Bt</h3>
<div class="level3">
<hr />

</div>
<!-- EDIT3 SECTION "Bt" [7795-7813] -->
<h3 class="sectionedit4" id="参考链接">参考链接</h3>
<div class="level3">

<p>
<a href="http://blog.csdn.net/bhj1119/article/details/51858635" class="urlextern" title="http://blog.csdn.net/bhj1119/article/details/51858635" rel="nofollow">http://blog.csdn.net/bhj1119/article/details/51858635</a>
</p>

</div>
<!-- EDIT4 SECTION "参考链接" [7814-] -->