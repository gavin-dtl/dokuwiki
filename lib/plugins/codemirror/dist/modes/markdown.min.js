(function(a){if(typeof exports=="object"&&typeof module=="object")a(require("../../lib/codemirror"),require("../xml/xml"),require("../meta"));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror","../xml/xml","../meta"],a);else a(CodeMirror)})(function(a){"use strict";a.defineMode("markdown",function(b,c){var d=a.getMode(b,"text/html");var e=d.name=="null";function f(c){if(a.findModeByName){var d=a.findModeByName(c);if(d)c=d.mime||d.mimes[0]}var e=a.getMode(b,c);return e.name=="null"?null:e}if(c.highlightFormatting===undefined)c.highlightFormatting=false;if(c.maxBlockquoteDepth===undefined)c.maxBlockquoteDepth=0;if(c.underscoresBreakWords===undefined)c.underscoresBreakWords=true;if(c.taskLists===undefined)c.taskLists=false;if(c.strikethrough===undefined)c.strikethrough=false;if(c.tokenTypeOverrides===undefined)c.tokenTypeOverrides={};var g={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var h in g){if(g.hasOwnProperty(h)&&c.tokenTypeOverrides[h]){g[h]=c.tokenTypeOverrides[h]}}var i=/^([*\-_])(?:\s*\1){2,}\s*$/,j=/^[*\-+]\s+/,k=/^[0-9]+([.)])\s+/,l=/^\[(x| )\](?=\s)/,m=c.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,n=/^ *(?:\={1,}|-{1,})\s*$/,o=/^[^#!\[\]*_\\<>` "'(~]+/,p=new RegExp("^("+(c.fencedCodeBlocks===true?"~~~+|```+":c.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)");function q(a,b,c){b.f=b.inline=c;return c(a,b)}function r(a,b,c){b.f=b.block=c;return c(a,b)}function s(a){return!a||!/\S/.test(a.string)}function t(a){a.linkTitle=false;a.em=false;a.strong=false;a.strikethrough=false;a.quote=0;a.indentedCode=false;if(e&&a.f==v){a.f=A;a.block=u}a.trailingSpace=0;a.trailingSpaceNewLine=false;a.prevLine=a.thisLine;a.thisLine=null;return null}function u(b,d){var e=b.sol();var h=d.list!==false,o=d.indentedCode;d.indentedCode=false;if(h){if(d.indentationDiff>=0){if(d.indentationDiff<4){d.indentation-=d.indentationDiff}d.list=null}else if(d.indentation>0){d.list=null}else{d.list=false}}var r=null;if(d.indentationDiff>=4){b.skipToEnd();if(o||s(d.prevLine)){d.indentation-=4;d.indentedCode=true;return g.code}else{return null}}else if(b.eatSpace()){return null}else if((r=b.match(m))&&r[1].length<=6){d.header=r[1].length;if(c.highlightFormatting)d.formatting="header";d.f=d.inline;return y(d)}else if(!s(d.prevLine)&&!d.quote&&!h&&!o&&(r=b.match(n))){d.header=r[0].charAt(0)=="="?1:2;if(c.highlightFormatting)d.formatting="header";d.f=d.inline;return y(d)}else if(b.eat(">")){d.quote=e?1:d.quote+1;if(c.highlightFormatting)d.formatting="quote";b.eatSpace();return y(d)}else if(b.peek()==="["){return q(b,d,F)}else if(b.match(i,true)){d.hr=true;return g.hr}else if((s(d.prevLine)||h)&&(b.match(j,false)||b.match(k,false))){var t=null;if(b.match(j,true)){t="ul"}else{b.match(k,true);t="ol"}d.indentation=b.column()+b.current().length;d.list=true;while(d.listStack&&b.column()<d.listStack[d.listStack.length-1]){d.listStack.pop()}d.listStack.push(d.indentation);if(c.taskLists&&b.match(l,false)){d.taskList=true}d.f=d.inline;if(c.highlightFormatting)d.formatting=["list","list-"+t];return y(d)}else if(c.fencedCodeBlocks&&(r=b.match(p,true))){d.fencedChars=r[1];d.localMode=f(r[2]);if(d.localMode)d.localState=a.startState(d.localMode);d.f=d.block=w;if(c.highlightFormatting)d.formatting="code-block";d.code=-1;return y(d)}return q(b,d,d.inline)}function v(b,c){var f=d.token(b,c.htmlState);if(!e){var g=a.innerMode(d,c.htmlState);if(g.mode.name=="xml"&&g.state.tagStart===null&&(!g.state.context&&g.state.tokenize.isInText)||c.md_inside&&b.current().indexOf(">")>-1){c.f=A;c.block=u;c.htmlState=null}}return f}function w(a,b){if(b.fencedChars&&a.match(b.fencedChars,false)){b.localMode=b.localState=null;b.f=b.block=x;return null}else if(b.localMode){return b.localMode.token(a,b.localState)}else{a.skipToEnd();return g.code}}function x(a,b){a.match(b.fencedChars);b.block=u;b.f=A;b.fencedChars=null;if(c.highlightFormatting)b.formatting="code-block";b.code=1;var d=y(b);b.code=0;return d}function y(a){var b=[];if(a.formatting){b.push(g.formatting);if(typeof a.formatting==="string")a.formatting=[a.formatting];for(var d=0;d<a.formatting.length;d++){b.push(g.formatting+"-"+a.formatting[d]);if(a.formatting[d]==="header"){b.push(g.formatting+"-"+a.formatting[d]+"-"+a.header)}if(a.formatting[d]==="quote"){if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(g.formatting+"-"+a.formatting[d]+"-"+a.quote)}else{b.push("error")}}}}if(a.taskOpen){b.push("meta");return b.length?b.join(" "):null}if(a.taskClosed){b.push("property");return b.length?b.join(" "):null}if(a.linkHref){b.push(g.linkHref,"url")}else{if(a.strong){b.push(g.strong)}if(a.em){b.push(g.em)}if(a.strikethrough){b.push(g.strikethrough)}if(a.linkText){b.push(g.linkText)}if(a.code){b.push(g.code)}if(a.image){b.push(g.image)}if(a.imageAltText){b.push(g.imageAltText,"link")}if(a.imageMarker){b.push(g.imageMarker)}}if(a.header){b.push(g.header,g.header+"-"+a.header)}if(a.quote){b.push(g.quote);if(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote){b.push(g.quote+"-"+a.quote)}else{b.push(g.quote+"-"+c.maxBlockquoteDepth)}}if(a.list!==false){var e=(a.listStack.length-1)%3;if(!e){b.push(g.list1)}else if(e===1){b.push(g.list2)}else{b.push(g.list3)}}if(a.trailingSpaceNewLine){b.push("trailing-space-new-line")}else if(a.trailingSpace){b.push("trailing-space-"+(a.trailingSpace%2?"a":"b"))}return b.length?b.join(" "):null}function z(a,b){if(a.match(o,true)){return y(b)}return undefined}function A(b,e){var f=e.text(b,e);if(typeof f!=="undefined")return f;if(e.list){e.list=null;return y(e)}if(e.taskList){var h=b.match(l,true)[1]!=="x";if(h)e.taskOpen=true;else e.taskClosed=true;if(c.highlightFormatting)e.formatting="task";e.taskList=false;return y(e)}e.taskOpen=false;e.taskClosed=false;if(e.header&&b.match(/^#+$/,true)){if(c.highlightFormatting)e.formatting="header";return y(e)}var i=b.sol();var j=b.next();if(e.linkTitle){e.linkTitle=false;var k=j;if(j==="("){k=")"}k=(k+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var m="^\\s*(?:[^"+k+"\\\\]+|\\\\\\\\|\\\\.)"+k;if(b.match(new RegExp(m),true)){return g.linkHref}}if(j==="`"){var n=e.formatting;if(c.highlightFormatting)e.formatting="code";b.eatWhile("`");var o=b.current().length;if(e.code==0){e.code=o;return y(e)}else if(o==e.code){var p=y(e);e.code=0;return p}else{e.formatting=n;return y(e)}}else if(e.code){return y(e)}if(j==="\\"){b.next();if(c.highlightFormatting){var q=y(e);var s=g.formatting+"-escape";return q?q+" "+s:s}}if(j==="!"&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,false)){e.imageMarker=true;e.image=true;if(c.highlightFormatting)e.formatting="image";return y(e)}if(j==="["&&e.imageMarker){e.imageMarker=false;e.imageAltText=true;if(c.highlightFormatting)e.formatting="image";return y(e)}if(j==="]"&&e.imageAltText){if(c.highlightFormatting)e.formatting="image";var q=y(e);e.imageAltText=false;e.image=false;e.inline=e.f=C;return q}if(j==="["&&b.match(/[^\]]*\](\(.*\)| ?\[.*?\])/,false)&&!e.image){e.linkText=true;if(c.highlightFormatting)e.formatting="link";return y(e)}if(j==="]"&&e.linkText&&b.match(/\(.*?\)| ?\[.*?\]/,false)){if(c.highlightFormatting)e.formatting="link";var q=y(e);e.linkText=false;e.inline=e.f=C;return q}if(j==="<"&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,false)){e.f=e.inline=B;if(c.highlightFormatting)e.formatting="link";var q=y(e);if(q){q+=" "}else{q=""}return q+g.linkInline}if(j==="<"&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,false)){e.f=e.inline=B;if(c.highlightFormatting)e.formatting="link";var q=y(e);if(q){q+=" "}else{q=""}return q+g.linkEmail}if(j==="<"&&b.match(/^(!--|\w)/,false)){var t=b.string.indexOf(">",b.pos);if(t!=-1){var u=b.string.substring(b.start,t);if(/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(u))e.md_inside=true}b.backUp(1);e.htmlState=a.startState(d);return r(b,e,v)}if(j==="<"&&b.match(/^\/\w*?>/)){e.md_inside=false;return"tag"}var w=false;if(!c.underscoresBreakWords){if(j==="_"&&b.peek()!=="_"&&b.match(/(\w)/,false)){var x=b.pos-2;if(x>=0){var z=b.string.charAt(x);if(z!=="_"&&z.match(/(\w)/,false)){w=true}}}}if(j==="*"||j==="_"&&!w){if(i&&b.peek()===" "){}else if(e.strong===j&&b.eat(j)){if(c.highlightFormatting)e.formatting="strong";var p=y(e);e.strong=false;return p}else if(!e.strong&&b.eat(j)){e.strong=j;if(c.highlightFormatting)e.formatting="strong";return y(e)}else if(e.em===j){if(c.highlightFormatting)e.formatting="em";var p=y(e);e.em=false;return p}else if(!e.em){e.em=j;if(c.highlightFormatting)e.formatting="em";return y(e)}}else if(j===" "){if(b.eat("*")||b.eat("_")){if(b.peek()===" "){return y(e)}else{b.backUp(1)}}}if(c.strikethrough){if(j==="~"&&b.eatWhile(j)){if(e.strikethrough){if(c.highlightFormatting)e.formatting="strikethrough";var p=y(e);e.strikethrough=false;return p}else if(b.match(/^[^\s]/,false)){e.strikethrough=true;if(c.highlightFormatting)e.formatting="strikethrough";return y(e)}}else if(j===" "){if(b.match(/^~~/,true)){if(b.peek()===" "){return y(e)}else{b.backUp(2)}}}}if(j===" "){if(b.match(/ +$/,false)){e.trailingSpace++}else if(e.trailingSpace){e.trailingSpaceNewLine=true}}return y(e)}function B(a,b){var d=a.next();if(d===">"){b.f=b.inline=A;if(c.highlightFormatting)b.formatting="link";var e=y(b);if(e){e+=" "}else{e=""}return e+g.linkInline}a.match(/^[^>]+/,true);return g.linkInline}function C(a,b){if(a.eatSpace()){return null}var d=a.next();if(d==="("||d==="["){b.f=b.inline=E(d==="("?")":"]",0);if(c.highlightFormatting)b.formatting="link-string";b.linkHref=true;return y(b)}return"error"}var D={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\\]]|\\.)*\])*?(?=\])/};function E(a){return function(b,d){var e=b.next();if(e===a){d.f=d.inline=A;if(c.highlightFormatting)d.formatting="link-string";var f=y(d);d.linkHref=false;return f}b.match(D[a]);d.linkHref=true;return y(d)}}function F(a,b){if(a.match(/^([^\]\\]|\\.)*\]:/,false)){b.f=G;a.next();if(c.highlightFormatting)b.formatting="link";b.linkText=true;return y(b)}return q(a,b,A)}function G(a,b){if(a.match(/^\]:/,true)){b.f=b.inline=H;if(c.highlightFormatting)b.formatting="link";var d=y(b);b.linkText=false;return d}a.match(/^([^\]\\]|\\.)+/,true);return g.linkText}function H(a,b){if(a.eatSpace()){return null}a.match(/^[^\s]+/,true);if(a.peek()===undefined){b.linkTitle=true}else{a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,true)}b.f=b.inline=A;return g.linkHref+" url"}var I={startState:function(){return{f:u,prevLine:null,thisLine:null,block:u,htmlState:null,indentation:0,inline:A,text:z,formatting:false,linkText:false,linkHref:false,linkTitle:false,code:0,em:false,strong:false,header:0,hr:false,taskList:false,list:false,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:false,strikethrough:false,fencedChars:null}},copyState:function(b){return{f:b.f,prevLine:b.prevLine,thisLine:b.thisLine,block:b.block,htmlState:b.htmlState&&a.copyState(d,b.htmlState),indentation:b.indentation,localMode:b.localMode,localState:b.localMode?a.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:false,linkTitle:b.linkTitle,code:b.code,em:b.em,strong:b.strong,strikethrough:b.strikethrough,header:b.header,hr:b.hr,taskList:b.taskList,list:b.list,listStack:b.listStack.slice(0),quote:b.quote,indentedCode:b.indentedCode,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside,fencedChars:b.fencedChars}},token:function(a,b){b.formatting=false;if(a!=b.thisLine){var c=b.header||b.hr;b.header=0;b.hr=false;if(a.match(/^\s*$/,true)||c){t(b);if(!c)return null;b.prevLine=null}b.prevLine=b.thisLine;b.thisLine=a;b.taskList=false;b.trailingSpace=0;b.trailingSpaceNewLine=false;b.f=b.block;var d=a.match(/^\s*/,true)[0].replace(/\t/g,"    ").length;b.indentationDiff=Math.min(d-b.indentation,4);b.indentation=b.indentation+b.indentationDiff;if(d>0)return null}return b.f(a,b)},innerMode:function(a){if(a.block==v)return{state:a.htmlState,mode:d};if(a.localState)return{state:a.localState,mode:a.localMode};return{state:a,mode:I}},blankLine:t,getType:y,fold:"markdown"};return I},"xml");a.defineMIME("text/x-markdown","markdown")});
//# sourceMappingURL=markdown.min.js.map